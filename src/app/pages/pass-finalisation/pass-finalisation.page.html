<ion-header>
  <practice-mode-banner *ngIf="isEndToEndPracticeMode"></practice-mode-banner>
  <ion-toolbar [ngClass]="{'toolbar-no-padding': isEndToEndPracticeMode}" mode="ios">
    <ion-title id="pass-finalisation-title">Test debrief - {{pageState.candidateUntitledName$ | async}}</ion-title>
    <ion-buttons id="back-button" slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div>
    <form (ngSubmit)="onSubmit()" [formGroup]="form">
      <ion-grid>
        <finalisation-header
          [candidateDriverNumber]="pageState.candidateDriverNumber$ | async"
          [candidateName]="pageState.candidateName$ | async"
          [outcomeText]="pageState.testOutcomeText$ | async">
        </finalisation-header>

        <application-reference-number
          [applicationNumber]="pageState.applicationNumber$ | async">
        </application-reference-number>

        <bike-category-type
          *ngIf="pageState.isBike$ | async"
          (categoryCodeChange)="categoryCodeChanged($event)"
          [categoryConfirmed]="true"
          [formGroup]="form"
          [testCategory]="pageState.testCategory$ | async"
          [testType]="pageState.bikeTestType$ | async">
        </bike-category-type>

        <license-provided
          *ngIf="(pageState.showLicenceProvided$ | async) && (!isNorthernIreland(pageState.candidateDriverNumber$ | async))"
          (licenseNotReceived)="provisionalLicenseNotReceived()"
          (licenseReceived)="provisionalLicenseReceived()"
          [form]="form"
          [licenseReceivedLabel]="'Provisional licence Received'"
          [license]="pageState.provisionalLicense$ | async">
        </license-provided>

        <licence-provided-warning-banner
          *ngIf="(pageState.showLicenceProvided$ | async) && (!isNorthernIreland(pageState.candidateDriverNumber$ | async))"
          [licenceProvided]="pageState.provisionalLicense$ | async">
        </licence-provided-warning-banner>

        <danger-banner
          *ngIf="isNorthernIreland(pageState.candidateDriverNumber$ | async)"
          [dangerText]="niMessage">
        </danger-banner>

        <warning-banner
          *ngIf="shouldShowCandidateDoesntNeedLicenseBanner()"
          warningText="{{askCandidateLicenseMessage}}">
        </warning-banner>

        <transmission
          *ngIf="pageState.showTransmission$ | async"
          [transmission]="pageState.transmission$ | async"
          (transmissionChange)="transmissionChanged($event)"
          [formGroup]="form">
        </transmission>

        <warning-banner
          *ngIf="displayTransmissionBanner()"
          [warningIdentifier]="'transmission-'"
          [warningText]="automaticMessage">
        </warning-banner>

        <code-78
          *ngIf="pageState.showCode78$ | async"
          [code78]="pageState.code78$ | async"
          (code78Present)="onCode78Present($event)"
          [form]="form">
        </code-78>

        <warning-banner
          *ngIf="shouldShowManualBanner()"
          [warningIdentifier]="'manual-licence-banner'"
          [warningText]="manualMessage">
        </warning-banner>

        <warning-banner
          *ngIf="shouldShowAutomaticBanner()"
          [warningIdentifier]="'automatic-licence-banner'"
          [warningText]="automaticMessage">
        </warning-banner>

        <pass-certificate-number
          *ngIf="pageState.showPassCert$ | async"
          (passCertificateNumberChange)="passCertificateNumberChanged($event)"
          [form]="form"
          [isPracticeMode]="isPracticeMode"
          [passCertificateNumberInput]="pageState.passCertificateNumber$ | async">
        </pass-certificate-number>

        <pass-certificate-number-cat-a-mod1
          *ngIf="pageState.showPassCertMod1$ | async"
          (passCertificateNumberChange)="passCertificateNumberChanged($event)"
          [form]="form"
          [isPracticeMode]="isPracticeMode"
          [passCertificateNumberInput]="pageState.passCertificateNumber$ | async">
        </pass-certificate-number-cat-a-mod1>

        <d255
          *ngIf="pageState.showD255$ | async"
          (d255Change)="d255Changed($event)"
          [d255]="pageState.d255$ | async"
          [display]="true"
          [eyesightTestFailed]="pageState.eyesightTestFailed$ | async"
          [formGroup]="form"
          [outcome]="testOutcome">
        </d255>

        <warning-banner
          *ngIf="pageState.d255$ | async"
          [warningIdentifier]="'d255-'"
          warningText="DVLA will not process the result until a D255 is received">
        </warning-banner>

        <language-preferences
          (welshChanged)="isWelshChanged($event)"
          [formGroup]="form"
          [isWelsh]="(pageState.conductedLanguage$ | async) === 'Cymraeg'">
        </language-preferences>

        <debrief-witnessed
          (debriefWitnessedChange)="debriefWitnessedChanged($event)"
          [debriefWitnessed]="pageState.debriefWitnessed$ | async"
          [display]="true"
          [formGroup]="form"
          [outcome]="testOutcome">
        </debrief-witnessed>

        <warning-banner
          *ngIf="pageState.showADI2Banner$ | async"
          warningText="Advise PDI to seek development for the Part 3 test from an ORDIT trainer">
        </warning-banner>

        <further-development
          *ngIf="pageState.displayFurtherDevelopment$ | async"
          (furtherDevelopmentChange)="furtherDevelopmentChanged($event)"
          [display]="true"
          [formGroup]="form"
          [furtherDevelopment]="pageState.furtherDevelopment$ | async"
          [outcome]="testOutcome">
        </further-development>

        <div *ngIf="(pageState.furtherDevelopment$ | async) !== false" class="mes-row-separator padding-top-10"></div>

        <reason-given
          *ngIf="pageState.displayAdviceReasonGiven$ | async"
          (adviceReason)="adviceReasonChanged($event)"
          [display]="true"
          [formGroup]="form"
          [furtherDevelopment]="pageState.furtherDevelopment$ | async"
          [outcome]="testOutcome"
          [reasonGivenText]="pageState.adviceReason$ | async">
        </reason-given>

        <test-start-end-times
          *ngIf="pageState.isStandardsCheck$ | async"
          (testEndTimeChange)="testEndTimeChanged($event)"
          (testStartTimeChange)="testStartTimeChanged($event)"
          [endTime]="pageState.testEndTime$ | async"
          [formGroup]="form"
          [startTime]="pageState.testStartTime$ | async">
        </test-start-end-times>
      </ion-grid>
    </form>
  </div>
</ion-content>

<ion-footer>
  <ion-row class="mes-full-width-card box-shadow">
    <ion-button (click)="onSubmit()" class="mes-primary-button" id="pass-finalisation-continue-button">
      <h3>Continue</h3>
    </ion-button>
  </ion-row>
</ion-footer>
