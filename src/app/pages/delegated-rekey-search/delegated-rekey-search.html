<ion-header>
    <ion-toolbar>
        <ion-title>Search test rekey backlog</ion-title>
        <ion-buttons id="delegated-rekey-search-back-button" slot="start">
            <ion-back-button></ion-back-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content force-overscroll="false">
    <div class="search-inputs ion-padding-end" [formGroup]="delegatedRekeyForm">
        <tabs>
            <tab [tabTitle]="'Rekey backlog'" id="tab-search-rekey">
                <ion-grid>
                    <ion-row>
                        <ion-col class="ion-align-self-center" size="32">
                            <label>Application reference</label>
                        </ion-col>
                        <ion-col size="38">
                            <ion-input placeholder="Application reference"
                                       id="rekey-search-application-reference"
                                       type="number"
                                       class="ion-input-styling custom-font-size"
                                       clearInput
                                       numbersOnly
                                       (ionFocus)="setFocus('appRef')"
                                       (ionBlur)="setFocus(null)"
                                       [ngClass]="{'input-focus': focusedElement === 'appRef'}"
                                       [value]="applicationReference"
                                       (change)="applicationReferenceChanged($event.target.value)">
                            </ion-input>
                        </ion-col>
                    </ion-row>

                    <ion-row *ngIf="hasClickedSearch && applicationReferenceInvalid" class="validation-message-row ion-align-items-center">
                        <div class="ion-padding-left validation-text" [class.ng-invalid]="applicationReferenceInvalid" id="delegated-search-validation-text">
                            Please enter a valid application reference number (11 digits)
                        </div>
                    </ion-row>

                    <ion-row class="ion-padding-top">
                        <ion-button [disabled]="(pageState.isLoading$ | async)"
                                    class="mes-primary-button search-tests"
                                    id="delegated-rekey-search-search-tests-btn"
                                    (click)="searchTests()">
                            <h3>
                                <ion-icon name="search" class="search-icon" id="rekey-search-search icon"></ion-icon>
                                Search booked tests
                            </h3>
                        </ion-button>
                        <ion-spinner class="search-spinner"
                                     name="bubbles"
                                     *ngIf="(pageState.isLoading$ | async)"
                                     id="rekey-search-page-spinner">
                        </ion-spinner>
                    </ion-row>
                </ion-grid>
            </tab>
        </tabs>

<!--        <div class='results-error' *ngIf="(pageState.hasSearched$ | async) && isBookedTestSlotEmpty(pageState.bookedTestSlot$ | async) && !hasBookingAlreadyBeenCompleted(pageState.rekeySearchErr$ | async) && !applicationReferenceInvalid">-->
<!--            <p class="error-text">-->
<!--                There were no results found for your search.-->
<!--            </p>-->
<!--            <p class="error-text">-->
<!--                Please check that you have entered the correct application reference and that a booking has been made.-->
<!--            </p>-->
<!--        </div>-->

<!--        <div class='results-error' *ngIf="(pageState.hasSearched$ | async) && hasBookingAlreadyBeenCompleted(pageState.rekeySearchErr$ | async) && !applicationReferenceInvalid">-->
<!--            <p class="error-text">-->
<!--                You can't rekey this test as it has already been submitted.-->
<!--            </p>-->
<!--            <p class="error-text">-->
<!--                Please check and try again.-->
<!--            </p>-->
<!--        </div>-->

<!--        <p class="results-message" *ngIf="!isBookedTestSlotEmpty(pageState.bookedTestSlot$ | async) && !applicationReferenceInvalid">-->
<!--            <test-slot [slot]="(pageState.bookedTestSlot$ | async)"-->
<!--                       [hasSlotChanged]="false"-->
<!--                       [delegatedTest]="true"-->
<!--                       [hasSeenCandidateDetails]="true"-->
<!--                       [showLocation]="false"></test-slot>-->
<!--        </p>-->

        <div class='results-error'
             *ngIf="(pageState.hasSearched$ | async) && isBookedTestSlotEmpty(pageState.bookedTestSlot$ | async) && !(hasBookingAlreadyBeenCompleted(pageState.rekeySearchErr$ | async))">
            <p class="error-text" id="rekey-search-error-text-no-results">There were no results found for your search.</p>
            <p class="error-text" id="rekey-search-error-text-no-pls-try-again">Please check and try again.</p>
        </div>

        <div class='results-error'
             *ngIf="(pageState.hasSearched$ | async) && (hasBookingAlreadyBeenCompleted(pageState.rekeySearchErr$ | async))">
            <p class="error-text" id="rekey-search-error-text-already-submitted">You can't rekey this test as it has already been submitted.</p>
            <p class="error-text" id="rekey-search-error-text-already-pls-try-again">Please check and try again.</p>
        </div>

        <p class="results-message" *ngIf="!isBookedTestSlotEmpty(pageState.bookedTestSlot$ | async)">
            <test-slot [slot]="(pageState.bookedTestSlot$ | async)"
                       [hasSlotChanged]="false"
                       [hasSeenCandidateDetails]="true"
                       [showLocation]="false">
            </test-slot>
        </p>

    </div>

</ion-content>
