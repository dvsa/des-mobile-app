<ion-header>
  <ion-toolbar mode="ios">
    <ion-buttons id="pass-cert-burger-menu-btn" slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title role="heading" aria-level="1" id="page-title">Examiner stats</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="{
  routeGrid: pageState.routeNumbers$ | async,
  manoeuvresGrid: pageState.manoeuvres$ | async,
  showMeQuestionsGrid: pageState.showMeQuestions$ | async,
  independentDrivingGrid: pageState.independentDriving$ | async,
  tellMeQuestionsGrid: pageState.tellMeQuestions$ | async,
  safetyAndBalanceGrid: pageState.safetyAndBalanceQuestions$ | async,
  testCount: pageState.testCount$ | async,
  controlledStops: pageState.controlledStops$ | async,
  outcomes: pageState.outcomes$ | async,
} as data">

    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-text class="des-header-style-4 fault-heading">View filters</ion-text>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <data-row-custom
          [shouldHaveSeperator]="true"
          [label]="'Date filter'">
          <ion-select
            [interfaceOptions]="{cssClass:'mes-select', enableBackdropDismiss:false}"
            class="input-styling-background black-text"
            (ionChange)="handleDateFilter($event)"
            labelPlacement="stacked"
            [placeholder]="defaultDate.display">
            <ion-select-option [value]="option" *ngFor="let option of dateFilterOptions;">
              {{option.display}}
            </ion-select-option>
          </ion-select>
        </data-row-custom>
        <data-row-custom
          [shouldHaveSeperator]="true"
          [label]="'Location filter'">
          <ion-select
            *ngIf="(pageState.locationList$ | async).length > 0"
            [interfaceOptions]="{cssClass:'mes-select', enableBackdropDismiss:false}"
            class="input-styling-background black-text"
            (ionChange)="handleLocationFilter($event?.detail?.value, true)"
            labelPlacement="stacked"
            [value]="locationSelectPristine ? null : currentTestCentre"
            [placeholder]="locationPlaceholder">
            <ion-select-option [value]="option" *ngFor="let option of locationFilterOptions;">
              {{option.centreName}}
            </ion-select-option>
          </ion-select>
          <ion-text *ngIf="(pageState.locationList$ | async).length == 0" class="mes-data">No locations available</ion-text>
        </data-row-custom>
        <data-row-custom
          [shouldHaveSeperator]="false"
          [label]="'Category filter'">
          <ion-select
            *ngIf="(pageState.categoryList$ | async).length > 0"
            [interfaceOptions]="{cssClass:'mes-select', enableBackdropDismiss:false}"
            class="input-styling-background black-text"
            (ionChange)="handleCategoryFilter($event?.detail?.value, true)"
            labelPlacement="stacked"
            [value]="categorySelectPristine ? null : currentCategory"
            [placeholder]="categoryPlaceholder">
            <ion-select-option [value]="option" *ngFor="let option of categoryFilterOptions;">
              {{option}}
            </ion-select-option>
          </ion-select>
          <ion-text *ngIf="(pageState.categoryList$ | async).length == 0" class="mes-data">No categories available</ion-text>
        </data-row-custom>
        <ion-accordion-group>
          <ion-accordion value="first">
            <ion-item (click)="accordionSelect()" slot="header">
              <label>Additional filters</label>
            </ion-item>
            <div (click)="blurElement($event.target)" class="ion-padding" slot="content">
              <data-row-custom [centeredLabel]="false" [shouldHaveSeperator]="false" [label]="'Colour options'">
                <colour-filter-radio
                  [formGroup]="form"
                  [colourScheme]="colourOption"
                  (filterChange)="colourFilterChanged($event)">
                </colour-filter-radio>
              </data-row-custom>
              <ion-row>
                <ion-col class="ion-align-items-center display-flex" size="20">
                  <label>Hide charts</label>
                </ion-col>
                <ion-col>
                  <input type="checkbox"
                         id="chart-toggle-input"
                         class="gds-checkbox"
                         (change)="toggleChart()"
                         [checked]="hideChart">
                  <label [for]="'chart-toggle-input'"></label>
                </ion-col>
              </ion-row>
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </ion-card-content>
    </ion-card>
  <div
    *ngIf="(pageState.categoryList$ | async).length > 0 &&
    (pageState.locationList$ | async).length > 0">
  <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.testCount">
      <ion-card-header>
        <ion-text class="des-header-style-4 fault-heading">Test stats</ion-text>
      </ion-card-header>
      <ion-card-content>
        <ion-row *ngIf="showControlledStop()">
          <ion-col [class.ion-no-padding]="hideChart" class="display-flex ion-justify-content-center">
            <chart
              *ngIf="!hideChart && showControlledStop()"
              [chartId]="'conStop'"
              [splitLabel]="false"
              [isPortrait]="orientationProvider.isPortraitMode$ | async"
              [chartType]="globalChartType ? globalChartType : 'pie'"
              [colors]="colourSelect('pie')"
              [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
              [labelColour]="getLabelColour(colourSelect(), 'pie')"
              [passedData]="data.controlledStops">
            </chart>
          </ion-col>
        </ion-row>
        <data-row
          [labelStyling]="colourSelect() === colors.navy ? 'color: white' : null"
          [dataStyling]="colourSelect() === colors.navy ? 'color: white' : null"
          [shouldHaveSeperator]="showControlledStop()"
          [value]="data.testCount"
          label="Tests started">
        </data-row>
        <data-row *ngIf="showControlledStop()"
                  [labelStyling]="colourSelect() === colors.navy ? 'color: white' : null"
                  [dataStyling]="colourSelect() === colors.navy ? 'color: white' : null"
                  [value]="data.controlledStops[0].count"
                  label="Controlled stop total">
        </data-row>
        <data-row *ngIf="showControlledStop()"
                  [labelStyling]="colourSelect() === colors.navy ? 'color: white' : null"
                  [dataStyling]="colourSelect() === colors.navy ? 'color: white' : null"
                  [shouldHaveSeperator]="false"
                  [value]="data.controlledStops[0].percentage"
                  label="Controlled stop (%)">
        </data-row>
      </ion-card-content>
    </ion-card>

    <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.routeGrid?.length">
      <ion-card-header>
        <ion-card-title>
          <ion-row>
            <ion-col>
              <ion-text class="des-header-style-4 fault-heading">Test routes completed</ion-text>
            </ion-col>
            <ion-col class="display-flex ion-justify-content-end">
              <div class="ion-text-end">
                <p class="ion-no-margin">{{dateFilter}}</p>
                <p class="ion-no-margin">{{locationFilter}}</p>
                <p class="ion-no-margin"> {{categoryDisplay}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div *ngIf="getTotal(data.routeGrid)">
          <ion-row>
            <ion-col [class.ion-no-padding]="hideChart" class="display-flex">
              <chart
                *ngIf="!hideChart"
                [chartId]="'routeNum'"
                [splitLabel]="false"
                [isPortrait]="orientationProvider.isPortraitMode$ | async"
                [chartType]="globalChartType ? globalChartType : 'bar'"
                [colors]="colourSelect('bar')"
                [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
                [labelColour]="getLabelColour(colourSelect(), 'bar')"
                [passedData]="data.routeGrid">
              </chart>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <data-grid
                [headers]="['Route', 'Amount', 'Percentage of total']"
                [colourScheme]="colourSelect('bar')"
                [displayColour]="!hideChart && (colourSelect('bar') !== colors.monochrome.bar && colourSelect('bar') !== colors.default.bar)"
                [passedData]="filterDataForGrid(data.routeGrid)">
              </data-grid>
              <div>
                <ion-row class="ion-padding-top mes-row-separator"></ion-row>
                <ion-row class="ion-padding-top display-flex ion-justify-content-center">
                  <ion-col size="10">
                    <label>Total:</label>
                  </ion-col>
                  <ion-col size="auto">
                    <span class="mes-data">{{getTotal(data.routeGrid)}}</span>
                  </ion-col>
                </ion-row>
              </div>
            </ion-col>
          </ion-row>
        </div>
        <ion-row class="display-flex ion-justify-content-center" *ngIf="!getTotal(data.routeGrid)">
          <ion-text class="des-header-style-3">No data to display</ion-text>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.manoeuvresGrid?.length">
      <ion-card-header>
        <ion-card-title>
          <ion-row>
            <ion-col>
              <ion-text class="des-header-style-4 fault-heading">Manoeuvres completed</ion-text>
            </ion-col>
            <ion-col class="display-flex ion-justify-content-end">
              <div class="ion-text-end">
                <p class="ion-no-margin">{{dateFilter}}</p>
                <p class="ion-no-margin">{{locationFilter}}</p>
                <p class="ion-no-margin"> {{categoryDisplay}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div *ngIf="getTotal(data.manoeuvresGrid)">
          <ion-row>
            <ion-col [class.ion-no-padding]="hideChart" class="display-flex">
              <chart
                *ngIf="!hideChart"
                [chartId]="'manoeuvresChart'"
                [splitLabel]="true"
                [isPortrait]="orientationProvider.isPortraitMode$ | async"
                [chartType]="globalChartType ? globalChartType : 'bar'"
                [colors]="colourSelect('bar')"
                [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
                [labelColour]="getLabelColour(colourSelect(), 'bar')"
                [passedData]="data.manoeuvresGrid">
              </chart>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <data-grid
                [headers]="['Manoeuvre', 'Amount', 'Percentage of total']"
                [colourScheme]="colourSelect('bar')"
                [displayColour]="!hideChart && (colourSelect('bar') !== colors.monochrome.bar && colourSelect('bar') !== colors.default.bar)"
                [passedData]="filterDataForGrid(data.manoeuvresGrid)">
              </data-grid>
              <div>
                <ion-row class="ion-padding-top mes-row-separator"></ion-row>
                <ion-row class="ion-padding-top display-flex ion-justify-content-center">
                  <ion-col size="10">
                    <label>Total:</label>
                  </ion-col>
                  <ion-col size="auto">
                    <span class="mes-data">{{getTotal(data.manoeuvresGrid)}}</span>
                  </ion-col>
                </ion-row>
              </div>
            </ion-col>
          </ion-row>
        </div>
        <ion-row class="display-flex ion-justify-content-center" *ngIf="!getTotal(data.manoeuvresGrid)">
          <ion-text class="des-header-style-3">No data to display</ion-text>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.showMeQuestionsGrid?.length">
      <ion-card-header>
        <ion-card-title>
          <ion-row>
            <ion-col>
              <ion-text class="des-header-style-4 fault-heading">Show me questions asked</ion-text>
            </ion-col>
            <ion-col class="display-flex ion-justify-content-end">
              <div class="ion-text-end">
                <p class="ion-no-margin">{{dateFilter}}</p>
                <p class="ion-no-margin">{{locationFilter}}</p>
                <p class="ion-no-margin"> {{categoryDisplay}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div *ngIf="getTotal(data.showMeQuestionsGrid)">
          <ion-row>
            <ion-col [class.ion-no-padding]="hideChart" class="display-flex">
              <chart
                *ngIf="!hideChart"
                [chartId]="'showMeChart'"
                [splitLabel]="true"
                [isPortrait]="orientationProvider.isPortraitMode$ | async"
                [chartType]="globalChartType ? globalChartType : 'bar'"
                [colors]="colourSelect('bar')"
                [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
                [labelColour]="getLabelColour(colourSelect(), 'bar')"
                [passedData]="data.showMeQuestionsGrid">
              </chart>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <data-grid
                [headers]="['Question', 'Amount', 'Percentage of total']"
                [colourScheme]="colourSelect('bar')"
                [displayColour]="!hideChart && (colourSelect('bar') !== colors.monochrome.bar && colourSelect('bar') !== colors.default.bar)"
                [passedData]="filterDataForGrid(data.showMeQuestionsGrid)">
              </data-grid>
              <div>
                <ion-row class="ion-padding-top mes-row-separator"></ion-row>
                <ion-row class="ion-padding-top display-flex ion-justify-content-center">
                  <ion-col size="10">
                    <label>Total:</label>
                  </ion-col>
                  <ion-col size="auto">
                    <span class="mes-data">{{getTotal(data.showMeQuestionsGrid)}}</span>
                  </ion-col>
                </ion-row>
              </div>
            </ion-col>
          </ion-row>
        </div>
        <ion-row class="display-flex ion-justify-content-center" *ngIf="!getTotal(data.showMeQuestionsGrid)">
          <ion-text class="des-header-style-3">No data to display</ion-text>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.tellMeQuestionsGrid?.length">
      <ion-card-header>
        <ion-card-title>
          <ion-row>
            <ion-col>
              <ion-text class="des-header-style-4 fault-heading">Tell me questions asked</ion-text>
            </ion-col>
            <ion-col class="display-flex ion-justify-content-end">
              <div class="ion-text-end">
                <p class="ion-no-margin">{{dateFilter}}</p>
                <p class="ion-no-margin">{{locationFilter}}</p>
                <p class="ion-no-margin"> {{categoryDisplay}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div *ngIf="getTotal(data.showMeQuestionsGrid)">
          <ion-row>
            <ion-col [class.ion-no-padding]="hideChart" class="display-flex">
              <chart
                *ngIf="!hideChart"
                [chartId]="'tellMeChart'"
                [splitLabel]="true"
                [isPortrait]="orientationProvider.isPortraitMode$ | async"
                [chartType]="globalChartType ? globalChartType : 'bar'"
                [colors]="colourSelect('bar')"
                [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
                [labelColour]="getLabelColour(colourSelect(), 'bar')"
                [passedData]="data.tellMeQuestionsGrid">
              </chart>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <data-grid
                [headers]="['Question', 'Amount', 'Percentage of total']"
                [colourScheme]="colourSelect('bar')"
                [displayColour]="!hideChart && (colourSelect('bar') !== colors.monochrome.bar && colourSelect('bar') !== colors.default.bar)"
                [passedData]="filterDataForGrid(data.tellMeQuestionsGrid)">
              </data-grid>
              <div>
                <ion-row class="ion-padding-top mes-row-separator"></ion-row>
                <ion-row class="ion-padding-top display-flex ion-justify-content-center">
                  <ion-col size="10">
                    <label>Total:</label>
                  </ion-col>
                  <ion-col size="auto">
                    <span class="mes-data">{{getTotal(data.tellMeQuestionsGrid)}}</span>
                  </ion-col>
                </ion-row>
              </div>
            </ion-col>
          </ion-row>
        </div>
        <ion-row class="display-flex ion-justify-content-center" *ngIf="!getTotal(data.showMeQuestionsGrid)">
          <ion-text class="des-header-style-3">No data to display</ion-text>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.safetyAndBalanceGrid?.length">
      <ion-card-header>
        <ion-card-title>
          <ion-row>
            <ion-col>
              <ion-text class="des-header-style-4 fault-heading">Safety and balance questions asked</ion-text>
            </ion-col>
            <ion-col class="display-flex ion-justify-content-end">
              <div class="ion-text-end">
                <p class="ion-no-margin">{{dateFilter}}</p>
                <p class="ion-no-margin">{{locationFilter}}</p>
                <p class="ion-no-margin"> {{categoryDisplay}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div *ngIf="getTotal(data.safetyAndBalanceGrid)">
          <ion-row>
            <ion-col [class.ion-no-padding]="hideChart" class="ion-justify-content-center display-flex">
              <chart
                *ngIf="!hideChart"
                [chartId]="'safetyChart'"
                [splitLabel]="true"
                [isPortrait]="orientationProvider.isPortraitMode$ | async"
                [chartType]="globalChartType ? globalChartType : 'pie'"
                [colors]="colourSelect('pie')"
                [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
                [labelColour]="getLabelColour(colourSelect(), 'pie')"
                [passedData]="data.safetyAndBalanceGrid">
              </chart>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <data-grid
                [headers]="['Question', 'Amount', 'Percentage of total']"
                [colourScheme]="colourSelect('pie')"
                [displayColour]="!hideChart"
                [passedData]="filterDataForGrid(data.safetyAndBalanceGrid)">
              </data-grid>
              <div>
                <ion-row class="ion-padding-top mes-row-separator"></ion-row>
                <ion-row class="ion-padding-top display-flex ion-justify-content-center">
                  <ion-col size="10">
                    <label>Total:</label>
                  </ion-col>
                  <ion-col size="auto">
                    <span class="mes-data">{{getTotal(data.safetyAndBalanceGrid)}}</span>
                  </ion-col>
                </ion-row>
              </div>
            </ion-col>
          </ion-row>
        </div>
        <ion-row class="display-flex ion-justify-content-center" *ngIf="!getTotal(data.safetyAndBalanceGrid)">
          <ion-text class="des-header-style-3">No data to display</ion-text>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <ion-card [class]="colourSelect() === colors.navy ? ['white-text' , 'navy-card'] : 'mes-black'"
              *ngIf="data.independentDrivingGrid?.length">
      <ion-card-header>
        <ion-card-title>
          <ion-row>
            <ion-col>
              <ion-text class="des-header-style-4 fault-heading">Independent driving</ion-text>
            </ion-col>
            <ion-col class="display-flex ion-justify-content-end">
              <div class="ion-text-end">
                <p class="ion-no-margin">{{dateFilter}}</p>
                <p class="ion-no-margin">{{locationFilter}}</p>
                <p class="ion-no-margin"> {{categoryDisplay}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div *ngIf="getTotal(data.independentDrivingGrid)">
          <ion-row *ngIf="!hideChart">
            <ion-col [class.ion-no-padding]="hideChart" class="ion-justify-content-center display-flex">
              <chart
                *ngIf="!hideChart"
                [chartId]="'independentDriving'"
                [splitLabel]="true"
                [isPortrait]="orientationProvider.isPortraitMode$ | async"
                [chartType]="globalChartType ? globalChartType : 'pie'"
                [colors]="colourSelect('pie')"
                [strokeColour]="colourSelect() === colors.navy ? '#243673' : '#FFFFFF'"
                [labelColour]="getLabelColour(colourSelect(), 'pie')"
                [passedData]="data.independentDrivingGrid">
              </chart>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <data-grid
                [headers]="['Question', 'Amount', 'Percentage of total']"
                [colourScheme]="colourSelect('pie')"
                [displayColour]="!hideChart"
                [passedData]="filterDataForGrid(data.independentDrivingGrid)">
              </data-grid>
              <div>
                <ion-row class="ion-padding-top mes-row-separator"></ion-row>
                <ion-row class="ion-padding-top display-flex ion-justify-content-center">
                  <ion-col size="10">
                    <label>Total:</label>
                  </ion-col>
                  <ion-col size="auto">
                    <span class="mes-data">{{getTotal(data.independentDrivingGrid)}}</span>
                  </ion-col>
                </ion-row>
              </div>
            </ion-col>
          </ion-row>
        </div>
        <ion-row class="display-flex ion-justify-content-center" *ngIf="!getTotal(data.independentDrivingGrid)">
          <ion-text class="des-header-style-3">No data to display</ion-text>
        </ion-row>
      </ion-card-content>
    </ion-card>

  </div>

  <div class="text-align-center
  padding-top-22
  ion-justify-content-center
  ion-align-items-center
  display-flex
  direction-column"
       *ngIf="(pageState.categoryList$ | async).length === 0 ||
       (pageState.locationList$ | async).length === 0">
    <ion-row>
      <ion-text class="mes-data">
        No driving test data available.<br>Try again when more tests have been completed.
      </ion-text>
    </ion-row>
    <ion-row class="padding-top">
      <ion-col class="ion-no-padding ion-text-left">
        <ion-button
          id="dlg-return-to-dashboard-btn"
          class="mes-primary-button"
          (click)="goToDashboard()">
          <ion-text id="dlg-return-to-dashboard-label" class="des-header-style-3">Return to dashboard</ion-text>
        </ion-button>
      </ion-col>
    </ion-row>

  </div>

</ion-content>
